# ðŸš€ DEPLOYMENT GUIDE - RENDER

## âœ… PRE-DEPLOYMENT CHECKLIST

Everything is configured and ready to deploy!

### What's Already Done:
- âœ… Backend configured (port 5000)
- âœ… Frontend configured
- âœ… Environment variables set up
- âœ… render.yaml created
- âœ… n8n webhook endpoint ready
- âœ… Retell AI integration complete
- âœ… MongoDB models ready
- âœ… Dashboard ready

---

## ðŸ“‹ DEPLOYMENT STEPS

### Step 1: Push to GitHub

```bash
git add .
git commit -m "Add Retell AI + n8n integration - production ready"
git push origin main
```

### Step 2: Deploy on Render

#### Option A: Using render.yaml (Recommended)

1. Go to [Render Dashboard](https://dashboard.render.com/)
2. Click **"New +"** â†’ **"Blueprint"**
3. Connect your GitHub repository: `Aivors`
4. Render will detect `render.yaml` automatically
5. Click **"Apply"**

#### Option B: Manual Deployment

**Backend:**
1. New â†’ Web Service
2. Connect GitHub repo
3. Settings:
   - Name: `aivors-backend`
   - Root Directory: `server`
   - Build Command: `npm install`
   - Start Command: `npm start`
   - Region: Oregon (or closest to you)

**Frontend:**
1. New â†’ Static Site
2. Connect GitHub repo
3. Settings:
   - Name: `aivors-frontend`
   - Build Command: `npm install && npm run build`
   - Publish Directory: `dist`

### Step 3: Add Environment Variables on Render

#### Backend Environment Variables:

**Required - Add these manually on Render:**
```
MONGO_URI=your_mongodb_connection_string

STRIPE_SECRET_KEY=your_stripe_secret_key

STRIPE_PUBLISHABLE_KEY=your_stripe_publishable_key

STRIPE_WEBHOOK_SECRET=your_stripe_webhook_secret

CLIENT_URL=https://aivors-frontend.onrender.com
(Replace with your actual frontend URL after deployment)

CORS_ORIGINS=https://www.aivors.com,https://aivors-frontend.onrender.com
(Replace with your actual domains)
```

**Auto-configured (already in render.yaml):**
```
PORT=5000
N8N_WEBHOOK_SECRET=aivors-secret
RETELL_API_KEY=key_29e6b0fb2923804d5ea659aa04b0
NODE_ENV=production
```

**Auto-generated by Render:**
```
JWT_SECRET (will be generated)
JWT_REFRESH_SECRET (will be generated)
```

#### Frontend Environment Variables:

```
VITE_API_URL=https://aivors-backend.onrender.com
(Replace with your actual backend URL after deployment)
```

### Step 4: Get Your URLs

After deployment completes:
- Backend URL: `https://aivors-backend.onrender.com`
- Frontend URL: `https://aivors-frontend.onrender.com`

**Save these URLs!** You'll need them for the next steps.

### Step 5: Update Frontend Environment Variable

1. Go to Frontend service on Render
2. Environment â†’ Add:
   ```
   VITE_API_URL=https://aivors-backend.onrender.com
   ```
3. Click "Save Changes"
4. Frontend will automatically redeploy

### Step 6: Update Backend CLIENT_URL

1. Go to Backend service on Render
2. Environment â†’ Update:
   ```
   CLIENT_URL=https://aivors-frontend.onrender.com
   CORS_ORIGINS=https://www.aivors.com,https://aivors-frontend.onrender.com
   ```
3. Click "Save Changes"
4. Backend will automatically redeploy

### Step 7: Update n8n Workflow

1. Go to: `https://n8n.srv971061.hstgr.cloud`
2. Open your workflow
3. Find the **HTTP Request** node
4. Update URL to:
   ```
   https://aivors-backend.onrender.com/api/n8n/retell-webhook
   ```
5. Keep header:
   ```
   x-n8n-webhook-secret: aivors-secret
   ```
6. Save and activate workflow

### Step 8: Verify Retell AI Webhook

1. Go to Retell AI Dashboard
2. Settings â†’ Webhooks
3. Verify URL is:
   ```
   https://n8n.srv971061.hstgr.cloud/webhook/retell-webhook
   ```
4. Verify `call_analyze` event is enabled

---

## ðŸ§ª TESTING

### Test 1: Backend Health
```bash
curl https://aivors-backend.onrender.com/api/health
```
Should return: `{"status":"ok"}`

### Test 2: Frontend
Open: `https://aivors-frontend.onrender.com`
Should load the dashboard

### Test 3: Login
1. Login at: `https://aivors-frontend.onrender.com`
2. Go to Call Analytics page
3. Should see empty state (no calls yet)

### Test 4: End-to-End (Real Call)
1. Make a test call through Retell AI
2. Retell AI â†’ sends to n8n
3. n8n â†’ forwards to your backend
4. Check dashboard â†’ should see the call!

---

## ðŸŽ¯ WHAT WORKS AFTER DEPLOYMENT

âœ… Customer calls AI agent via Retell AI  
âœ… Retell sends webhook to n8n  
âœ… n8n forwards to your Render backend  
âœ… Backend saves call + transcript to MongoDB  
âœ… Backend deducts minutes from subscription  
âœ… Dashboard shows call analytics  
âœ… When credits = 0 â†’ n8n auto-disables workflow  

---

## ðŸ”§ TROUBLESHOOTING

### Backend Not Starting?
- Check Render logs: Settings â†’ Logs
- Verify all environment variables are set
- Check MongoDB connection string is correct

### Frontend Not Loading?
- Verify `VITE_API_URL` is set correctly
- Check browser console for errors
- Try hard refresh (Ctrl+Shift+R)

### Dashboard Shows No Data?
- Test backend endpoint: `/api/health`
- Check n8n workflow is active
- Verify Retell AI webhook is configured
- Check Render backend logs for errors

### n8n Webhook Not Working?
- Verify backend URL in n8n is correct
- Check webhook secret matches
- Look at n8n execution logs

---

## ðŸ“ž SUPPORT

If something doesn't work:
1. Check Render logs (both services)
2. Check n8n execution logs
3. Test each endpoint individually
4. Verify all URLs are updated

---

## ðŸŽ‰ YOU'RE DONE!

After completing all steps:
- âœ… Backend deployed on Render
- âœ… Frontend deployed on Render
- âœ… n8n connected to backend
- âœ… Retell AI â†’ n8n â†’ Backend â†’ Dashboard (complete flow)
- âœ… Production ready!

**Next step:** Push to GitHub and deploy! ðŸš€
